## Digitally Adjustable Phrenic Nerve (DAPhNe) Stimulator System
### Northwestern University BME Senior Capstone Design (2016-2017)
#### Center for Autonomic Medicine in Pediatrics (CAMP) at Ann & Robert H. Lurie Children's Hospital of Chicago
<br></br>
<br></br>
Information will be updated in the next few weeks.
<br></br>
<br></br>

## Project Description
### Introduction
### What is DAPhNe?
### Next Steps 
<br></br>
<br></br>
## Quick Start 
Currently, the DAPhNe system consists of two PCB prototype boards used for nerve stimulation soon to be tested on New Zealand white rabbits for efficacy and function. The external user interface is being developed concurrently. Future developers should read the documents listed, make sure they have access to the listed hardware, and install the listed software. The following "checklists" are intended to make this process as fast and easy as possible.
### Important Documents 
The following documents are essential to read in order to understand the purpose, scope, and technical progress of the project in more detail:
* [**BME 390 Final Report: DAPhNe Stimulator System (2017)**]() generated by the 2016-17 BME 390 team - the most recent information on the project, design process, and team progress on the hardware/software design **TO DO**  
* [**Developing DAPhNe Stimulator**]() guide included in this repository - refer to this document for detailed step-by-step instructions for hardware and software implementation of the project **TO DO** 

### Harware Checklist
The hardware used so far is both custom-designed and off-the-shelf; some components are used currently, while others have been used in the early stages of the project.

Custom and off-the-shelf hardware used currently:
* 2 x **IPNS_v0.1 STIM**
  - Custom stimulation circuit controlled by IPNS_v0.1 MCU (see assembly instructions below)
  - Was designed using the free EagleCAD software (link below)
* 2 x **IPNS_v0.1 MCU**
  - Custom MCU module featuring I2C bus to the NFC memory tag and breakout pins for IPNS_v0.1 STIM
  - Was designed using the free EagleCAD software (link below)
* 4 x [**ANT7-T-M24LR04E**](http://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/st25-nfc-rfid-eval-boards/st25-nfc-rfid-antennas/ant7-t-m24lr04e.html) Board
  - NFC memory tag used in wireless communication on the **IPNS_v0.1 MCU** board
  - NFC Transceiver board wirelessly reads/writes the EEPROM memory on the tag; MCU reads from the memory using I2C communication
* 1 x [**M24LR-DISCOVERY Transceiver**](http://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/st25-nfc-rfid-eval-boards/st25-nfc-rfid-eval-boards/m24lr-discovery.html) Board
  - Used to communicate with the NFC memory tag
  - Utilizes the ST NFC communication GUI at this point; see below for installation instructions
* 2 x [**ST-LINK/V2 in-circuit debugger/programmer for STM8**](http://www.st.com/en/development-tools/st-link-v2.html?s_searchtype=partnumber)
  - Debugging interface for the STM8L microcontroller
  - See instructions below for interfacing STM8L with your Mac/PC using ST-LINK/V2

The following devices have been used (and may still be useful) in the development of the current IPNS System:
* 2 x [**STM8L-DISCOVERY**](http://www.st.com/en/evaluation-tools/stm8l-discovery.html) Board
  - Evaluation board used for preliminary code testing of the STM8L microcontroller
  - Very useful for debugging and reference circuit design (schematics [**here**](https://github.com/AlexeyRevinski/BME390/blob/master/Reference%20Documentation/STM8L-DISCOVERY%20Schematic.pdf))
* 1 x [**M24LR-DISCOVERY Receiver**](http://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/st25-nfc-rfid-eval-boards/st25-nfc-rfid-eval-boards/m24lr-discovery.html) Board
  - Used for development of the NFC memory tag
  - Has not been used in the project much except to test the transceiver included in the kit



### Software Checklist 
In order to get started on the software side of the project, first clone the project repository onto your local machine into a folder of your choice. In the cloned folder, the following software and documentation will be included:
* [**Microcontroller Project**](https://github.com/AlexeyRevinski/BME390/tree/master/Implant%20STM8L%20Program%20NFC%2BPulse/Project) for a STM8L151C6xx device
  - Under `.../Implant STM8L Program NFC+Pulse/Project/`
  - Uses IAR Embedded Workbench (see below) for development
  - To open once IAR is installed, open the `workspace.eww` file under `...\Implant STM8L Program NFC+Pulse\Project\EWSTM8`
* [**Standard Peripheral Library**](https://github.com/AlexeyRevinski/BME390/tree/master/Implant%20STM8L%20Program%20NFC%2BPulse/STM8L15x_StdPeriph_Driver) for STM8L15x devices
  - Under `.../Implant STM8L Program NFC+Pulse/STM8L15x_StdPeriph_Driver`
  - **DO NOT MOVE** relative to `/Project` folder or else the project will not compile
  - See page **TO DO** of the [**Developing DAPhNe Stimulator**]() **TO DO**.
* [**LTSPice Simulation Files**](https://github.com/AlexeyRevinski/BME390/tree/master/LTSpice)
  - Under `.../LTSpice`
  - Currently include stimulation circuit separately
* [**EagleCAD project files**](https://github.com/AlexeyRevinski/BME390/tree/master/Eagle) for IPNS_v0.1 MCU and IPNS_v0.1 STIM boards
  - Under `.../Eagle`
  - Includes board and schematic files for both boards
  - Includes custom component library that contains every component used in both boards (`IPNS_Lib_v0.1.lbr`)
  - Includes CAM job used to create Gerber files for both boards (`sfe-gerb274x-JEB.cam`)
* [**Reference Documentation**](https://github.com/AlexeyRevinski/BME390/tree/master/Reference%20Documentation)
  - Component Datasheets
  - Application articles
  - EagleCAD files for certain components
  - Software manual for IAR
* Obsolete IAR projects that can be used for reference and preliminary "visualization" Solidworks model of the implantable device

Once the project is cloned, download the following software and then follow the step-by-step instructions in the [**Developing DAPhNe Stimulator**]() manual (Section "*Configuring Software*"):
* [**GitHub Desktop**](https://desktop.github.com/) - a simple git client for managing the project repository on GitHub.
* [**IAR Embedded Workbench for STM8**](https://www.iar.com/iar-embedded-workbench/#!?architecture=STM8) - IDE used to program the STM8L MCU used in the implantable stimulator - follow the guide in [**Developing DAPhNe Stimulator**]() for proper installation and project configuration
* [**ST-LINK/V2 Driver**](http://www.st.com/content/st_com/en/products/embedded-software/development-tool-software/stsw-link009.html) (should be automatically installed during IAR Embedded Workbench installation)
* [**ST-LINK/V2 Firware Upgrade**](http://www.st.com/content/st_com/en/products/embedded-software/development-tool-software/stsw-link007.html)(should be automatically installed during IAR Embedded Workbench installation)
* [**EagleCAD**](http://www.autodesk.com/products/eagle/free-download) - printed circuit board(PCB) CAD software. There are lots of great [**tutorials**](https://www.youtube.com/watch?v=1AXwjZoyNno) online
* [**LTSpice**](http://www.linear.com/designtools/software/#LTspice) - very user-friendly Spice simulation software
* [**ST Microelectronics NFC Communication GUI**](http://www.st.com/content/st_com/en/products/embedded-software/st25-nfc-rfid-software/stsw-m24lr011.html) - software used to communicate with the **ANT7-T-M24LR04E** tag using the **M24LR-DISCOVERY Transceiver Board**.

### Other Useful Software
* [**Notepad++**](https://notepad-plus-plus.org/download/v7.3.1.html) - very useful text editor for viewing/modifying various text/code files
* [**nScope**](http://www.nscope.org/) - although not required, very useful for probing the circuit during development. Northwestern students will encounter this great resource in their introductory electronics ME233/BME305 courses. 
* [**Adafruit library**](https://github.com/adafruit/Adafruit-Eagle-Library/zipball/master) for EagleCAD - general components available at [adafruit.com](https://www.adafruit.com)


